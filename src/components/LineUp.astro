---
import IconSlider from "./IconSlider.astro";
import RotatingBackground from "./RotatingBackground.astro";

// Heart SVG for separators
const HeartSeparator = `
<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="inline-block mx-4 heart-separator">
  <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
</svg>
`;
---

<section id="lineup" class="lineup-section">
    <!-- Top Slider (Left to Right) -->
    <div class="absolute top-0 w-full z-20">
        <IconSlider direction="right" />
    </div>

    <!-- Rotating Background -->
    <RotatingBackground />

    <!-- Hearts Container for floating animation -->
    <div class="hearts-container"></div>

    <!-- Artist Layout -->
    <div class="container mx-auto px-4 py-4 relative z-10 text-center">
        <!-- Headliners -->
        <div class="flex flex-col items-center gap-2 mb-4">
            <a
                href="#"
                class="artist-name headline hover-artist"
                id="el-bogueto"
                data-artist="EL BOGUETO"
            >
                EL BOGUETO
            </a>
            <a
                href="#"
                class="artist-name headline hover-artist"
                id="little-jesus"
                data-artist="LITTLE JESUS"
            >
                LITTLE JESUS
            </a>
        </div>

        <!-- Accent Artist -->
        <div class="mb-4">
            <a
                href="#"
                class="artist-name accent-headline hover-artist"
                data-artist="ODISSEO"
            >
                ODISSEO
            </a>
        </div>

        <!-- Paired Artists -->
        <div class="flex flex-col gap-3 items-center justify-center">
            <!-- Row 1 -->
            <div class="artist-row">
                <a href="#" class="artist-name mid hover-artist">CACHIRULA</a>
                <span class="text-white" set:html={HeartSeparator} />
                <span class="text-white" set:html={HeartSeparator} />
                <a href="#" class="artist-name mid hover-artist">KINKY</a>
            </div>

            <!-- Row 2 -->
            <div class="artist-row">
                <a href="#" class="artist-name mid hover-artist">LOOJAN</a>
                <span class="text-white" set:html={HeartSeparator} />
                <a href="#" class="artist-name mid hover-artist">JAVIER BLAKE</a
                >
            </div>

            <!-- Row 3 -->
            <div class="artist-row">
                <a href="#" class="artist-name mid hover-artist">YEYO</a>
                <span class="text-white" set:html={HeartSeparator} />
                <a href="#" class="artist-name mid hover-artist">DOONY GRAFF</a>
            </div>

            <!-- Row 4 -->
            <div class="artist-row">
                <a href="#" class="artist-name text-[22px] hover-artist"
                    >ALANIS YUKI</a
                >
                <span class="text-white" set:html={HeartSeparator} />
                <a href="#" class="artist-name text-[22px] hover-artist"
                    >PLASTIKBOY</a
                >
            </div>
        </div>

        <!-- Bottom Artist -->
        <div class="mt-4">
            <a
                href="#"
                class="artist-name text-[22px] hover-artist"
                data-artist="DENNA LA PORRI"
            >
                DENNA LA PORRI
            </a>
        </div>

        <!-- CTA Button -->
        <div class="absolute bottom-8 left-4 text-left z-30 hidden md:block">
            <a
                href="https://arema.mx/dango-festival"
                target="_blank"
                rel="noopener noreferrer"
                class="cta-button"
            >
                COMPRA TUS BOLETOS
            </a>
        </div>
    </div>

    <!-- Bottom Slider (Right to Left) -->
    <div class="absolute bottom-0 w-full z-20">
        <IconSlider direction="left" />
    </div>
</section>

<script>
    import { gsap } from "gsap";
    import { getRandomDangoColor } from "../utils/colorUtils";

    document.addEventListener("astro:page-load", () => {
        // Match EL BOGUETO width to LITTLE JESUS
        const elBogueto = document.getElementById("el-bogueto");
        const littleJesus = document.getElementById("little-jesus");

        const adjustFont = () => {
            if (!elBogueto || !littleJesus) return;

            // Reset to original to measure correctly if resizing down
            elBogueto.style.fontSize = "";

            const targetWidth = littleJesus.getBoundingClientRect().width;
            const currentWidth = elBogueto.getBoundingClientRect().width;

            if (currentWidth === 0) return;

            const currentFontSize = parseFloat(
                window.getComputedStyle(elBogueto).fontSize,
            );
            const newFontSize = currentFontSize * (targetWidth / currentWidth);

            elBogueto.style.fontSize = `${newFontSize}px`;
        };

        // Initial adjust
        // Small timeout to ensure fonts are loaded/rendering
        setTimeout(adjustFont, 50);
        window.addEventListener("resize", adjustFont);

        // Random color hover for artists
        const artistLinks = document.querySelectorAll(".hover-artist");
        artistLinks.forEach((link) => {
            link.addEventListener("mouseenter", () => {
                (link as HTMLElement).style.color = getRandomDangoColor();
            });

            link.addEventListener("mouseleave", () => {
                // Keep Odisseo accent color if not hovered, otherwise white
                if (link.classList.contains("accent-headline")) {
                    (link as HTMLElement).style.color =
                        "var(--color-dango-orange)";
                } else {
                    (link as HTMLElement).style.color = "";
                }
            });
        });

        // Hearts animation on artist hover
        const heartsContainer = document.querySelector(".hearts-container");
        artistLinks.forEach((link) => {
            // Spawn hearts continuously while hovering or just a burst on enter
            link.addEventListener("mouseenter", () => {
                // Create a burst of hearts throughout the viewport
                for (let i = 0; i < 5; i++) {
                    createRandomHeart(heartsContainer as HTMLElement);
                }
            });

            // Also add some random hearts while moving mouse over name
            link.addEventListener("mousemove", () => {
                if (Math.random() > 0.7) {
                    // Rate limiter
                    createRandomHeart(heartsContainer as HTMLElement);
                }
            });
        });
    });

    function createRandomHeart(container: HTMLElement) {
        const heart = document.createElement("div");
        heart.classList.add("heart");
        heart.textContent = "â™¥";

        // Random position in viewport (fixed container)
        const x = Math.random() * window.innerWidth;
        const y = Math.random() * window.innerHeight;

        // Apply ALL positioning styles inline to ensure they take effect
        heart.style.cssText = `
          position: absolute;
          left: ${x}px;
          top: ${y}px;
          font-size: ${1 + Math.random() * 2}rem;
          color: ${getRandomDangoColor()};
          pointer-events: none;
        `;

        container.appendChild(heart);

        // Random float direction
        const xMove = (Math.random() - 0.5) * 100;

        gsap.to(heart, {
            y: -100 - Math.random() * 100,
            x: xMove,
            opacity: 0,
            rotation: Math.random() * 90 - 45,
            duration: 1 + Math.random() * 2,
            ease: "power2.out",
            onComplete: () => heart.remove(),
        });
    }
</script>

<style>
    .lineup-section {
        height: calc(100vh - var(--navbar-height));
        scroll-margin-top: var(--navbar-height);
        background: #000;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .hearts-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
        z-index: 9999;
        overflow: hidden;
    }

    .heart {
        position: absolute;
        font-size: 2rem;
        pointer-events: none;
    }

    .artist-name {
        display: inline-block;
        font-family: var(--font-kismis);
        font-weight: bold;
        color: #fff;
        text-transform: uppercase;
        transition: all 0.3s ease;
        letter-spacing: 0.05em;
        cursor: pointer;
        line-height: 1;
    }

    .headline {
        font-size: 4rem; /* 64px */
    }

    .accent-headline {
        font-size: 5rem; /* 80px */
        color: var(--color-dango-orange);
    }

    .mid {
        font-size: 2.25rem; /* 36px */
    }

    .small {
        font-size: 1.75rem; /* 28px */
    }

    .artist-row {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .artist-name:hover {
        transform: scale(1.1);
    }

    /* Heart separator animation */
    .heart-separator {
        animation: pulse 2s infinite ease-in-out;
    }

    @keyframes pulse {
        0% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.2);
        }
        100% {
            transform: scale(1);
        }
    }

    .cta-button {
        display: inline-block;
        padding: 1rem 3rem;
        background: var(--color-dango-purple);
        color: white;
        font-family: var(--font-outfit);
        font-size: 1.25rem;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 0;
        transition: all 0.3s ease;
        letter-spacing: 0.1em;
    }

    .cta-button:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 40px rgba(255, 20, 147, 0.5);
    }

    @media (max-width: 768px) {
        .headline {
            font-size: 2.5rem;
        }
        .accent-headline {
            font-size: 3rem;
        }
        .mid {
            font-size: 1.5rem;
        }
        .artist-row {
            gap: 0.25rem;
        }
    }
</style>
