---
interface Props {
    direction?: "left" | "right";
    speed?: number;
}

const { direction = "left", speed = 30 } = Astro.props;

// Icon names M1.svg to M20.svg
const iconNames = Array.from({ length: 20 }, (_, i) => `M${i + 1}.svg`);
---

<div class="slider-container" data-direction={direction}>
    <div class="slider-track">
        {
            iconNames.map((icon) => (
                <div class="slider-item">
                    <img
                        src={`/icons/${icon}`}
                        alt="Festival Icon"
                        class="icon-img"
                    />
                </div>
            ))
        }
        <!-- Duplicate for seamless loop -->
        {
            iconNames.map((icon) => (
                <div class="slider-item">
                    <img
                        src={`/icons/${icon}`}
                        alt="Festival Icon"
                        class="icon-img"
                    />
                </div>
            ))
        }
    </div>
</div>

<script>
    import { gsap } from "gsap";

    document.addEventListener("astro:page-load", () => {
        const sliders = document.querySelectorAll(".slider-container");

        sliders.forEach((container) => {
            const direction = container.getAttribute("data-direction");
            const track = container.querySelector(
                ".slider-track",
            ) as HTMLElement;

            if (!track) return;

            const items = track.querySelectorAll(".slider-item");
            const itemWidth = (items[0] as HTMLElement).offsetWidth;
            const totalWidth = itemWidth * (items.length / 2); // Half because duplicated

            gsap.to(track, {
                x: direction === "left" ? -totalWidth : totalWidth,
                duration: totalWidth / 30, // Adjust speed
                ease: "none",
                repeat: -1,
                modifiers: {
                    x: gsap.utils.unitize((x) => parseFloat(x) % totalWidth),
                },
            });
        });
    });
</script>

<style>
    .slider-container {
        width: 100%;
        overflow: hidden;
        position: relative;
        height: 60px;
        background: transparent;
    }

    .slider-track {
        display: flex;
        gap: 1rem;
        will-change: transform;
    }

    .slider-item {
        flex-shrink: 0;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .icon-img {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }
</style>
