---

---

<div class="rotating-bg-container">
    <div class="sunburst"></div>
    <div class="center-circle"></div>
    <div class="pulsing-assets-container"></div>
</div>

<script>
    import { gsap } from "gsap";
    import { getRandomDangoColor } from "../utils/colorUtils";

    document.addEventListener("astro:page-load", () => {
        // 1. Set random color for background elements
        const randomColor = getRandomDangoColor();
        const container = document.querySelector(
            ".rotating-bg-container",
        ) as HTMLElement;

        if (container) {
            container.style.setProperty("--bg-color", randomColor);
        }

        // 2. Pulse sunburst opacity instead of rotation
        gsap.to(".sunburst", {
            opacity: 0.4,
            duration: 2,
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
        });

        // 3. Create random pulsing assets (aces)
        const assetsContainer = document.querySelector(
            ".pulsing-assets-container",
        );
        if (assetsContainer) {
            // Create a few random shapes/assets floating
            for (let i = 0; i < 5; i++) {
                createFloatingAsset(assetsContainer as HTMLElement);
            }
        }
    });

    function createFloatingAsset(container: HTMLElement) {
        const asset = document.createElement("div");
        asset.classList.add("floating-asset");

        // Random initial position
        const x = Math.random() * 100;
        const y = Math.random() * 100;

        asset.style.left = `${x}%`;
        asset.style.top = `${y}%`;

        // Add simple diamond shape (ace-like)
        asset.innerHTML = `
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2L2 12l10 10 10-10L12 2z"/>
      </svg>
    `;

        container.appendChild(asset);

        // Pulse animation
        gsap.to(asset, {
            scale: 1.5,
            opacity: 0.8,
            duration: 1 + Math.random(),
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
            delay: Math.random(),
        });

        // Float animation
        gsap.to(asset, {
            x: (Math.random() - 0.5) * 100,
            y: (Math.random() - 0.5) * 100,
            duration: 10 + Math.random() * 10,
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
        });
    }
</script>

<style>
    .rotating-bg-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 200vmax; /* Make it huge to cover screen */
        height: 200vmax;
        z-index: 0;
        pointer-events: none;
        opacity: 0.15; /* Subtle background */
        --bg-color: #8b5cf6; /* Default fallback */
        overflow: hidden;
    }

    /* Sunburst effect using conic gradient */
    .sunburst {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: repeating-conic-gradient(
            from 0deg,
            transparent 0deg 15deg,
            var(--bg-color) 15deg 30deg
        );
        mask-image: radial-gradient(
            circle,
            transparent 6%,
            black 6%
        ); /* Smaller hole in center */
        -webkit-mask-image: radial-gradient(circle, transparent 6%, black 6%);
    }

    .center-circle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 12%;
        height: 12%;
        border-radius: 50%;
        background: var(--bg-color);
        opacity: 0.5;
        filter: blur(50px);
    }

    .pulsing-assets-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    :global(.floating-asset) {
        position: absolute;
        color: white;
        opacity: 0.3;
    }
</style>
